clear all; close all; clc;


WP = [

% % HGU BUS
% 36.1036427196527	129.391649630224
% 36.1037275311157	129.391354333984

% % ===========================================
% 
% % HGU YeSeon
% 
% 36.1022913267561	129.3845898575060
% 36.1023773088055	129.3844960764630
% 36.1024050440871	129.384468936366
% 36.1025013474257	129.384365099943
% 36.1026037336232	129.384246428084
% 
% 36.1026518920265	129.384191261218
% 36.1027153502750	129.384120496550
% 36.1027208172524	129.384104144465
% 36.1027212728338	129.384088356246
% 36.1027126167862	129.384066365511
% 
% 36.1026607696510	129.384003149888
% 36.1026453121472	129.383989706160
% 36.1026271391322	129.383987120827
% 36.1026089198952	129.3839959057100
% 36.1025581096269	129.3840544051030
% 
% 36.1025002095136	129.3841231418910
% 36.1024588522637	129.3841728663750
% 36.1024482175388	129.3841940724050
% 36.1024470359026	129.3842189346470
% 36.1024570798096	129.3842386781930
% 
% 36.1024759859842	129.3842679278890
% 36.1024954829719	129.3842949838590
% 36.1025055268727	129.3843169211310
% 36.1025078901433	129.3843425146160
% 36.1024988159684	129.3843659417980
% 
% 36.1024641418981	129.3844048338290
% 36.1023773088055	129.3844960764630
% 36.1022913267561	129.3845898575060
% 36.1021908169863	129.3846951176740

36.1036408304377	129.386084558278
36.10344917	129.3860037
36.10328469	129.3859376
36.10313618	129.3858746
36.10300601	129.3858204
36.10286417	129.3857615
36.10272375	129.3857081

36.1026801049690	129.385693621596
36.1026191104920	129.385730850382
36.1025681424681	129.385815649284
36.1025221876641	129.385940779370


% % ===========================================

% % HGU BonSeon
% 
% 36.1034693492419	129.3859670426860
% 36.1033048707687	129.3859009251300
% 36.1031563580931	129.3858379138690
% 36.1030261931530	129.3857838027460
% 36.1028843479412	129.3857248415290
% 
% 36.1027439306655	129.3856714152260
% 36.1026599987584	129.3856386541480
% 36.1026101139165	129.3856273493650
% 36.1025693628954	129.3856090877920
% 36.1025243962269	129.3855716950490
% 
% 36.1024807755202	129.3854842601430
% 36.1024766311325	129.3854505107570
% 36.1024606790481	129.3854110236670
% 36.1023695804393	129.385199031032
% 36.1023422449694	129.385167762780
% 
% 36.1023174040923	129.385121030446
% 36.1022905759361	129.385076142810
% 36.1022354291420	129.384999895318
% 36.1021996582279	129.384955622581
% 36.1021753141242	129.384921803129
% 
% 36.1021638872974	129.384891673072
% 36.1021586041154	129.3848418358390
% 36.1021354095254	129.3848171156480
% 36.1021025505112	129.3848203053500
% 36.1020812887887	129.3848577843490
% 
% 36.1020877317355	129.3849000479010
% 36.1021141478119	129.3849175912620
% 36.1021450739388	129.3849223758150
% 36.1021819555074	129.384945768346
% 36.1022184022632	129.384989185950
% 
% 36.1022840063809	129.385081095943
% 36.1023158972517	129.385130152197
% 36.1023391320208	129.385175825261
% 36.1023436597175	129.385208936967
% 36.1023584144417	129.385248938507
% 
% 36.1024434297037	129.385451120202
% 36.1024659484068	129.385477447982
% 36.1024800005033	129.385510492732
% 36.1025197437063	129.3855843381260
% 36.1025583869409	129.3856321660530
% 
% 36.1026033535900	129.3856599932110
% 36.1026526567304	129.3856697656310
% 36.1027363359344	129.385701238850
% 36.1028501558855	129.385749299611
% 36.1029382679526	129.385787231775
% 
% 36.1030894723079	129.3858520149950
% 36.1032484522302	129.3859184241000
% 36.1034102351549	129.3859833450300

% ===========================================

% % YeSeon last
% 37.2389203500000	126.7729569000000
% 37.2390777554350	126.7730630064020
% 37.2392083494601	126.7731477533080
% 37.2393587105347	126.7732429872940
% 37.2395017158483	126.7733343895790
% 
% 37.2396147377912	126.7734124073860
% 37.2397745868392	126.7735137892640
% 37.2398666730383	126.7735731331390
% 37.2399087808373	126.7735998159040
% 37.2399384080838	126.7736215247060
% 
% 37.2399601112865	126.773634403494
% 37.2400814689171	126.773707669482
% 37.2401120444389	126.773714307610
% 37.2401414875224	126.773708143634
% 37.2401720630199	126.773690125856
% 
% 37.2401956892095	126.773649194688
% 37.2402362513357	126.773559874498
% 37.2403065594735	126.7734063209720
% 37.2403477041859	126.7733119647150
% 37.2403576288948	126.7732665735640
% 
% 37.2403497000000	126.7732232000000
% 37.2403217060376	126.7731847069180
% 37.2402817770626	126.7731567853290
% 37.2401459019578	126.773072245625
% 37.2400641512481	126.773025513291
% 
% 37.2400344257215	126.7730196708220
% 37.2400026802390	126.7730160054890
% 37.2399735728508	126.7730203929430
% 37.2399456297476	126.7730342865490
% 37.2399188509307	126.7730606112760
% 37.2398926542527	126.7730946140490
% 37.2398301740003	126.7732351348900
% 37.2397774647088	126.7733608538900
% 37.2397624500763	126.7733889903550
% 37.2397423659157	126.7734076370360
% 37.2397211174501	126.7734109276270
% 37.2396998689785	126.7734080026580
% 37.2396777472756	126.7733959371580
% 37.2395374051239	126.7733051947310
% 37.2393948600000	126.7732103000000
% 37.2392407200000	126.7731124000000
% 37.2391086000000	126.7730268000000
% 37.2390310000000	126.7729754000000
% 37.2389816000000	126.7729433000000
% 37.2389420800000	126.7729133000000
% 37.2389050300000	126.7728844000000

% ===========================================

% % BonSeon last
% 37.2389274639399	126.7729642648970
% 37.2390638622798	126.7730555930410
% 37.2392622456336	126.7731797838290
% 37.2394849274378	126.7733282763010
% 37.2397323271966	126.7734874912420
% 37.2399718250569	126.7736469914930
% 37.2401714337322	126.7737834600880
% 37.2404127490419	126.7739370494160
% 37.2406346233543	126.7740801742450
% 37.2408193540060	126.7742030019080
% 
% 37.2409662183463	126.7742888842900
% 37.2411416114616	126.7743794232190
% 37.2413175679714	126.7744479520630
% 37.2414287211790	126.7744750373080
% 37.2415462050740	126.7744818011990
% 37.2417119512092	126.774533123614
% 37.2418668521103	126.774554395777
% 37.2419557642179	126.774565771240
% 37.2420298575608	126.774568873639
% 37.2421055973471	126.774567839506
% 
% 37.2421612357213	126.7745669037540
% 37.2422074683821	126.7745680041080
% 37.2422633619317	126.7745302431210
% 37.2422949420555	126.7744993571260
% 37.2423277105477	126.7744756747960
% 37.2423764806316	126.7744620752930
% 37.2424987110970	126.7744607905320
% 37.2426550875276	126.7744578101680
% 37.2427144160141	126.7744440784200
% 37.2427667933821	126.7744244016480
% 
% 37.2428015484380	126.7743924268930
% 37.2428225972668	126.7743481541560
% 37.2428270028349	126.7743001920240
% 37.2428269393350	126.7742488487090
% 37.2428166150849	126.7742138890800
% 37.2428030130576	126.7741856551540
% 37.2427959665807	126.7741479168770
% 37.2427961817884	126.7740607990200
% 37.2427920297056	126.7740299791370
% 37.2427825931530	126.7740010558620
% 
% 37.2427663622797	126.7739894391370
% 37.2427456175194	126.7739887279090
% 37.2427260609195	126.7740028588870
% 37.2427182725867	126.7740306547420
% 37.2427172049616	126.7740903338930
% 37.2427164814040	126.7741850163240
% 37.2427118790049	126.7742382444770
% 37.2427019313958	126.7742866042850
% 37.2426814586486	126.7743260768480
% 37.2426475658478	126.7743540102670
% 
% 37.2426109826420	126.7743642506710
% 37.2425673696086	126.7743701204620
% % 37.2424468843402	126.7743744155790
% % 37.2422875091466	126.7743762675860
% % 37.2420926704494	126.7743839370170
% % 37.2419458377155	126.7743908590560
% 
% 37.2424471877031	126.774371142955
% 37.2423848095805	126.774364396384
% 37.2421941602579	126.774366359927
% 37.2420814902514	126.774368615387
% 37.2420340432331	126.774386840540
% 
% 37.2419068511753	126.774392533223
% 37.2416225347601	126.7743963367110
% 37.2414650492259	126.7743901063460
% 37.2413317292250	126.7743652962860
% 
% 37.2411705848031	126.7743054467550
% 37.2410056169598	126.7742169012810
% 37.2408647261267	126.7741345024660
% 37.2406901923270	126.7740290209060
% 37.2405189333187	126.7739398087620
% 37.2404176906571	126.7738778757520
% 37.2403166892745	126.7738113396830
% 37.2401584332227	126.7737038524860
% 37.2400291782458	126.7736247413150
% 37.2398697728738	126.7735190810810
% 
% 37.2396852755717	126.7734023610280
% 37.2394793683074	126.7732632068620
% 37.2392887495850	126.7731396289680
% 37.2391420468448	126.7730467611810
% 37.2389861285862	126.7729454559520
% 37.2389139412694	126.7728928064980
% 37.2388708617087	126.7728569756190







% % 37.2389005774421	126.772943825829
% % 37.2390671352066	126.773049773085
% % 37.2392657228294	126.773174495804
% % 37.2394895249441	126.773321836831
% % 37.2397375211347	126.773481247679
% % 37.2399756253584	126.773638834866
% % 37.2401751109667	126.773777595924
% % 37.2404169358174	126.773930090908
% % 37.2406347584387	126.774072358026
% % 37.2408223221177	126.774199032006
% % 37.2409684760026	126.774284424777
% % 37.2411449239222	126.774373743797
% % 37.2413196686276	126.774442143654
% % 37.2414318997223	126.774468972290
% % 37.2415468151451	126.774474610940
% % 37.2417597594546	126.774515261199
% % 37.2419108899715	126.774530364008
% % 37.2420597019289	126.774545121587
% % 37.2421915774003	126.774562781438
% % 37.2422334908041	126.774561318953
% % 37.2422783770338	126.774535244314
% % 37.2423069438103	126.774496170463
% % 37.2423383970032	126.774473168303
% % 37.2423770900078	126.774458690442
% % 37.2425005781873	126.774455588043
% % 37.2426563283166	126.774453898319
% % 37.2427144160141	126.774444078420
% % 37.2427667933821	126.774424401648
% % 37.2428015484380	126.774392426893
% % 37.2428225972668	126.774348154156
% % 37.2428270028349	126.774300192024
% % 37.2428269393350	126.774248848709
% % 37.2428166150849	126.774213889080
% % 37.2428030130576	126.774185655154
% % 37.2427959665807	126.774147916877
% % 37.2427959665807	126.774096041298
% % 37.2427923755359	126.774063900994
% % 37.2427833979232	126.774035143879
% % 37.2427663404561	126.774019355660
% % 37.2427474874616	126.774017664065
% % 37.2427281855814	126.774028941364
% % 37.2427156169126	126.774053751424
% % 37.2427160657936	126.774092094243
% % 37.2427174124368	126.774185131966
% % 37.2427135290979	126.774238786799
% % 37.2427041025947	126.774287843053
% % 37.2426834540596	126.774328441332
% % 37.2426484413133	126.774356634582
% % 37.2426116330240	126.774367348016
% % 37.2425676426059	126.774369603476
% % 37.2424475218338	126.774370336123
% % 37.2422886078430	126.774371863694
% % 37.2420930816029	126.774379361100
% % 37.2419464747614	126.774388439540
% % 37.2418297644026	126.774395205920
% % 37.2416225347601	126.774396336711
% % 37.2414658896777	126.774385268527
% % 37.2413338313858	126.774360635309
% % 37.2411740266268	126.774300865620
% % 37.2410083424072	126.774212188698
% % 37.2408673904276	126.774130992140
% % 37.2406939205300	126.774025198469
% % 37.2405226794289	126.773937297169
% % 37.2404197520340	126.773875180455
% % 37.2403193698696	126.773808221356
% % 37.2401610090989	126.773701390719
% % 37.2400322975127	126.773621511557
% % 37.2398723774624	126.773516290116
% % 37.2396883496865	126.773398271640
% % 37.2394812218102	126.773260137880
% % 37.2392922438183	126.773135415160
% % 37.2391449862242	126.773041783440
% % 37.2389912731876	126.772942169780
% % 37.2389178432824	126.772888058660
% % 37.2388747643714	126.772851164710

];

% WP_real = [37.23962276 126.77341556];
% WP_map  = [37.2396193963976 126.773421666579];



%%%%%%%%%%%%%%%% Heading Angles Array
for i = 1 : size(WP,1)-1
    heading_angle(i) = azimuth('rh', WP(i,1), WP(i,2), WP(i+1,1), WP(i+1,2));
    if heading_angle(i) > 180.0
        heading_angle(i) = heading_angle(i) - 360;
    end
end
heading_angle(size(WP,1)) = 0.0;
heading_angle = heading_angle';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% geoplot_with_index(WP, 'g*-', 2, 'Waypoints 2022' )
% hold on;
% geoplot_with_index(WP2, 'r*-', 2, 'Waypoints 2022' )

% geoplot_with_index(WP, 'g*-', 2, 'Waypoints 2022' )


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Calculate Offset
WP_real = [37.23962276 126.77341556];
WP_map  = [37.2396193963976 126.773421666579];
% offset = WP_map - WP_real;
offset = (WP_map - WP_real);

coordinates_new = [ WP(:,1)+offset(1) WP(:,2)+offset(2) ];
% coordinates_draw = [ WP(:,1)-offset(1) WP(:,2)-offset(2) ];

WP = coordinates_new;

geoplot_with_index(WP, 'g*-', 2, 'Waypoints 2022' )
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

waypoints_with_heading = [WP heading_angle];

dt = datestr(now,'mm-dd,HHMM');
filename = strcat('data/WP_', dt, '.csv');
writematrix(waypoints_with_heading, filename)

dispstr = strcat('Waypoints array saved as [', ' ', filename, ']');
disp(dispstr)

%% WP making by ginput

clear all; close all; clc;

% at K-City
geoplot_with_index([37.2385578428457 126.772551559268 ; 37.2438603022230 126.774883256760], 'g*', 1, 'test')

% % at HGU
% geoplot_with_index([36.1035756043610 129.386241858694 ; 36.1027914729013 129.385989285697], 'g*', 1, 'test')

WP_real = [37.23962276 126.77341556];   
WP_map  = [37.2396193963976 126.773421666579];
offset = WP_map - WP_real;

hold on;

geoplot_with_index(WP_real, 'b*', 1, 'test')
hold on;
geoplot_with_index(WP_map, 'r*', 1, 'test')

WP_real_test = WP_map - offset;
hold on;
geoplot_with_index(WP_real_test, 'w.', 1, 'test')


WP = [

36.1036138174795	129.386059675868
36.1035560487760	129.386037415492
36.1035037481836	129.386016882363
36.1034449518096	129.385993793503
36.1033870298492	129.385971959061
36.1033162323693	129.385943533387
36.1032491529585	129.385916139276
36.1031737213144	129.385886635141
36.1031028747937	129.385858124619
36.1030276145588	129.385826979073
36.1029456321232	129.385792840126
36.1028690238292	129.385761438726
36.1028081245771	129.385733869827
36.1027402429904	129.385706240443
36.1026964531225	129.385691553903
36.1026536824929	129.385688760628
36.1026214339879	129.385700162491
36.1025968079261	129.385726853856
36.1025757269303	129.385769031193
36.1025605381416	129.385814588862
36.1025459179654	129.385861266062
36.1025298292411	129.385902927955
36.1025215739690	129.385943047646
36.1025117908143	129.385977545843
36.1025017518993	129.386011369142
36.1024962869181	129.386029816116
36.1024933060191	129.386038424704

];


geoplot_with_index(WP, 'g*-', 2, 'Waypoints 2022' )

hold on;

WP_real2 = [ WP(:,1) - offset(1) WP(:,2) - offset(2)];

geoplot_with_index(WP_real2, 'm*-', 2, 'Waypoints 2022' )

%% real-time plot of ginput data

clear all; close all; clc;

set(gcf, 'Position', get(0, 'Screensize'));

%=====================================
% Calculate Offset
WP_real = [37.23962276 126.77341556];
WP_map  = [37.2396193963976 126.773421666579];
offset = WP_map - WP_real;
% offset = (WP_map - WP_real)*2;
%=====================================

%=====================================
% at K-City
% geoplot_with_index([37.2385578428457 126.772551559268 ; 37.2438603022230 126.774883256760], 'g*', 1, 'test')

% filename = 'data/RESTART_YS_MORAI_DATA.csv'; % MORAI YeSeon
% filename = 'data/RESTART_BS_MORAI_DATA.csv'; % MORAI BonSeon
filename1 = 'data/WP_10-04,0325.csv';
filename2 = 'data/WP_10-04,0343.csv';
WP_BG = readmatrix(filename1);
WP_BG2 = readmatrix(filename2);

%=====================================
% Eliminate Offset
WP_BACK_new1 = [ WP_BG(:,1)-offset(1) WP_BG(:,2)-offset(2) ];
WP_BG = WP_BACK_new1;
WP_BACK_new2 = [ WP_BG2(:,1)+offset(1) WP_BG2(:,2)+offset(2) ];
WP_BG2 = WP_BACK_new2;
%=====================================

geoplot_with_index(WP_BG, 'y.-', 1, 'test')
hold on;
geoplot_with_index(WP_BG2, 'b.-', 1, 'test')

% hold on;
% geoplot_with_index(WP9, 'W.-', 1, 'test')
%=====================================

%=====================================
% % at HGU
% geoplot_with_index([36.1035756043610 129.386241858694 ; 36.1027914729013 129.385989285697], 'g*', 1, 'test')
%=====================================



% %=====================================
% %=====================================
% n = 2; % select number of waypoints
% %=====================================
% %=====================================

hold on;
i = 1;
while true
    
    enableDefaultInteractivity(gca);
    [lat, lon] = ginput(1);
    coordinates(i,:) = [lat, lon];
    
    if i > 1
        if abs(coordinates_temp(1) - coordinates(i,1)) <= 0.0000001 && abs(coordinates_temp(2) - coordinates(i,2)) <= 0.0000001
            break
        end
    end

    geoplot_with_index(coordinates, 'g*-', 1, 'test')
    coordinates_temp = coordinates(i,:);
    i = i + 1;

end
hold off;

coordinates(end,:) = [];

% hold on;
% for i = 1 : n
%     enableDefaultInteractivity(gca);
%     [lat, lon] = ginput(1);
%     coordinates(i,:) = [lat, lon];
%     geoplot_with_index(coordinates, 'g*-', 1, 'test')
% end
% hold off;

coordinates_new = [ coordinates(:,1)-offset(1) coordinates(:,2)-offset(2) ];

WP = coordinates_new;

% % Algorithm Verification
% geoplot_with_index(coordinates, 'g*-', 2, 't  est')
% hold on;
% geoplot_with_index(coordinates_new, 'r*-', 2, 'test')

%%%%%%%%%%%%%%%% Heading Angles Array
for i = 1 : size(WP,1)-1
    heading_angle(i) = azimuth('rh', WP(i,1), WP(i,2), WP(i+1,1), WP(i+1,2));
    if heading_angle(i) > 180.0
        heading_angle(i) = heading_angle(i) - 360;
    end
end
heading_angle(size(WP,1)) = 0.0;
heading_angle = heading_angle';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

waypoints_with_heading = [WP heading_angle];

dt = datestr(now,'mm-dd,HHMM');
filename = strcat('data/WP_', dt, '.csv');
writematrix(waypoints_with_heading, filename)

dispstr = strcat('Waypoints array saved as [', ' ', filename, ']');
disp(dispstr)



%% PLOT WAYPOINTS

clear all; close all; clc;

filename1 = 'data/WP_09-15,2213_BonSeon_75points_edit.csv';
filename2 = 'data/WP_09-16,1227_BonSeon_75points.csv';
filename3 = 'data/WP_09-28,0250.csv';
filename4 = 'data/WP_09-16,1117_YeSeon_46points.csv';
filename5 = 'data/WP_09-20,2211_BonSeon_78points.csv'; % delivery added
filename6 = 'data/WP_10-01,0520_GalSang_BonSeon_48pts.csv';
filename7 = 'data/RESTART_YS_MORAI_DATA2.csv';
filename8 = 'data/RESTART_YS_MORAI_DATA.csv'; % MORAI YeSeon
filename9 = 'data/RESTART_BS_MORAI_DATA.csv'; % MORAI BonSeon
filename10 = 'data/WP_10-07,0304_YeSeon_69pts.csv';
filename11 = 'data/WP_10-03,2109_BonSeon_106pts.csv';
filename12 = 'data/WP_10-05,0441_BonSeon_143pts.csv';

% open('data/ALL_DONE.fig')

WP1 = readmatrix(filename1);
WP1(:,3) = [];

WP2 = readmatrix(filename2);
WP2(:,3) = [];

WP3 = readmatrix(filename3);
WP3(:,3) = [];

WP4 = readmatrix(filename4);
WP4(:,3) = [];

WP5 = readmatrix(filename5);
WP5(:,3) = [];

WP6 = readmatrix(filename6);
WP6(:,3) = [];

WP7 = readmatrix(filename7);
% WP7(:,3) = [];

WP8 = readmatrix(filename8);
% WP8(:,3) = [];

WP9 = readmatrix(filename9);
% WP9(:,3) = [];

WP10 = readmatrix(filename10);
WP10(:,3) = [];
% Calculate Offset
WP_real = [37.23962276 126.77341556];
WP_map  = [37.2396193963976 126.773421666579];
offset = WP_map - WP_real;
% coordinates_new = [ WP10(:,1)+offset(1) WP10(:,2)+offset(2) ];
% WP10 = coordinates_new;

WP11 = readmatrix(filename11);
WP11(:,3) = [];
coordinates_new = [ WP11(:,1)+offset(1)*2 WP11(:,2)+offset(2)*2 ];
WP11 = coordinates_new;

WP12 = readmatrix(filename12);
WP12(:,3) = [];

% open('data/ALL_DONE.fig')

% geoplot_with_index(WP1, 'g*-', 1, 'Waypoints Plot')
% hold on;
% geoplot_with_index(WP2, 'r*-', 1, 'Waypoints Plot')
% hold on;
% geoplot_with_index(WP3, 'b*-', 1, 'Waypoints Plot')
% hold on;
% geoplot_with_index(WP4, 'w*-', 1, 'Waypoints Plot')
% hold on;
% geoplot_with_index(WP5, 'y*-', 1, 'Waypoints Plot')
% hold on;
geoplot_with_index(WP6, 'y*-', 1, 'Waypoints Plot')
% hold on;
geoplot_with_index(WP7, 'g.-', 3, 'Waypoints Plot')
hold on;
geoplot_with_index(WP8, 'y.-', 3, 'Waypoints Plot')
hold on;
geoplot_with_index(WP9, 'w.-', 2, 'Waypoints Plot')
hold on;
geoplot_with_index(WP10, 'w*-', 3, 'Waypoints Plot')
hold on;
geoplot_with_index(WP11, 'r*-', 2, 'Waypoints Plot')
hold on;
geoplot_with_index(WP12, 'b*-', 2, 'Waypoints Plot')




%% PLOT .fig FILES

clear all; close all; clc;

filename = 'data/0916_YeSeon.fig';

load(filename);


%% WP modifying

clear all; close all; clc;

filename = 'data/WP_10-07,0304_YeSeon_69pts.csv';

WP = readmatrix(filename);
WP(:,3) = [];

%%%%%%%%%%%%%%%% Heading Angles Array
for i = 1 : size(WP,1)-1
    heading_angle(i) = azimuth('rh', WP(i,1), WP(i,2), WP(i+1,1), WP(i+1,2));
    if heading_angle(i) > 180.0
        heading_angle(i) = heading_angle(i) - 360;
    end
end
heading_angle(size(WP,1)) = 0.0;
heading_angle = heading_angle';
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

waypoints_with_heading = [WP heading_angle];

dt = datestr(now,'mm-dd,HHMM');
filename = strcat('data/WP_', dt, '.csv');
writematrix(waypoints_with_heading, filename)

dispstr = strcat('Waypoints array saved as [', ' ', filename, ']');
disp(dispstr)


